// code generated by github.com/kaltura/ott-tool-codegen. DO NOT EDIT.

package setup

import (
	"context"
	kronos "github.com/kaltura/ott-client-kronos-grpc-go"
	log "github.com/kaltura/ott-lib-log"
	"github.com/kaltura/ott-service-phoenix/generated/configuration"
    tasks "github.com/kaltura/ott-service-phoenix/generated/tasks/recurring"
)

func RegisterServiceRecurringTasks(ctx context.Context) error {
	logger, ctx := log.GetOrCreateInContext(ctx)
	cfg := configuration.GetConfiguration()

	kronosClient := kronos.NewKronosAsyncClient(ctx, configuration.GetServiceName(), "kronos", string(cfg.Kafka.ConnectionString))

	registerRecurrenceTasksRequest := kronos.RegisterServiceRecurringTasksRequest{
		ServiceName: configuration.GetServiceName(),
		Tasks: map[string]*kronos.RegisterServiceRecurrenceTaskItem{

                tasks.ScheduleRecordingEvictionsQualifiedName:{
                    CronExpression: "@every 1h",
				    TimeoutSecs:    600,
                },
		},
	}

	_, err := kronosClient.RegisterServiceRecurringTasks(&registerRecurrenceTasksRequest)
	if err != nil {
		logger.Fatalf("failed to register recurring task in kronos [%s]", err.Error())
		return err
	}

	return nil
}

